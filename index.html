<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BelajarKuy - Auto Quiz AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .btn-duo {
      transition: all 0.1s;
      box-shadow: 0 5px 0 rgba(0,0,0,0.1);
    }
    .btn-duo:active:not(:disabled) {
      transform: translateY(5px);
      box-shadow: 0 0px 0 rgba(0,0,0,0);
    }
    .btn-green {
      background-color: #22c55e;
      color: white;
      box-shadow: 0 5px 0 #16a34a;
    }
    .btn-green:active:not(:disabled) {
      box-shadow: 0 0px 0 #16a34a;
    }
    .btn-red {
      background-color: #ef4444;
      color: white;
      box-shadow: 0 5px 0 #dc2626;
    }
    .btn-red:active:not(:disabled) {
      box-shadow: 0 0px 0 #dc2626;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex items-center justify-center p-4">

  <!-- SCREEN 1: INPUT MATERI -->
  <div id="screen-input" class="max-w-md w-full bg-white rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] p-6 border-2 border-slate-100 block">
    <div class="flex items-center gap-3 mb-6">
      <div class="bg-green-500 p-3 rounded-2xl text-white">
        <i class="fa-solid fa-bolt text-2xl"></i>
      </div>
      <h1 class="text-2xl font-extrabold text-slate-700">BelajarKuy!</h1>
    </div>
    <p class="text-slate-500 mb-4 font-medium">Masukin materi. Ntar AI bikin kuis Pilihan Ganda, Ketik, & Susun Kata!</p>
    <textarea id="material-input" placeholder="Contoh: Majapahit adalah sebuah kerajaan besar di Nusantara..." class="w-full h-48 p-4 rounded-2xl border-2 border-slate-200 focus:border-green-500 focus:ring-0 resize-none mb-4 outline-none transition-colors"></textarea>
    <p id="error-msg" class="text-red-500 text-sm mb-4 font-bold hidden"></p>
    <button onclick="generateQuestions()" class="btn-duo btn-green w-full font-bold py-4 rounded-2xl flex justify-center items-center gap-2 text-lg">
      <i class="fa-solid fa-wand-magic-sparkles"></i> Buat Kuis
    </button>
  </div>

  <!-- SCREEN 2: LOADING -->
  <div id="screen-loading" class="hidden flex-col items-center justify-center w-full max-w-md bg-white p-10 rounded-3xl border-2 border-slate-100">
    <i class="fa-solid fa-spinner fa-spin text-green-500 text-5xl mb-4"></i>
    <h2 class="text-xl font-bold text-slate-700 animate-pulse text-center">AI lagi mikir soal yang pas...</h2>
  </div>

  <!-- SCREEN 3: QUIZ -->
  <div id="screen-quiz" class="hidden max-w-xl w-full flex-col h-[90vh] sm:h-auto">
    <!-- Progress Bar -->
    <div class="w-full bg-slate-200 h-4 rounded-full mb-8 overflow-hidden shrink-0">
      <div id="progress-bar" class="bg-green-500 h-full rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
    </div>

    <h2 id="question-text" class="text-xl sm:text-2xl font-extrabold text-slate-800 mb-6 shrink-0">Pertanyaan?</h2>

    <!-- Area Konten (Opsi/Ketik/Susun) -->
    <div id="options-container" class="flex flex-col gap-3 flex-1 overflow-y-auto mb-4 pb-4"></div>

    <!-- Bottom Action Area -->
    <div id="action-area" class="mt-auto p-6 rounded-3xl bg-white border-2 border-slate-200 transition-colors shrink-0">
      <div id="feedback-area" class="hidden items-center gap-3 mb-4">
        <i id="feedback-icon" class="fa-solid fa-circle-check text-green-600 text-3xl"></i>
        <div class="flex-1">
          <h3 id="feedback-text" class="text-xl sm:text-2xl font-extrabold text-green-700">Benar!</h3>
          <p id="correct-answer-text" class="text-sm font-bold text-red-600 hidden mt-1"></p>
        </div>
      </div>
      
      <button id="btn-check" onclick="checkAnswer()" disabled class="btn-duo w-full py-4 rounded-2xl font-bold text-xl bg-slate-200 text-slate-400 cursor-not-allowed">
        Cek Jawaban
      </button>
      
      <button id="btn-next" onclick="nextQuestion()" class="hidden btn-duo btn-green w-full py-4 rounded-2xl font-bold text-xl flex justify-center items-center gap-2">
        Lanjut <i class="fa-solid fa-arrow-right"></i>
      </button>
    </div>
  </div>

  <!-- SCREEN 4: RESULT -->
  <div id="screen-result" class="hidden max-w-md w-full bg-white rounded-3xl shadow-lg p-8 border-2 border-slate-100 flex-col items-center text-center">
    <div id="final-score" class="w-32 h-32 rounded-full border-8 border-green-500 flex items-center justify-center mb-6 bg-green-50 text-green-600 font-black text-5xl">
      0/5
    </div>
    <h2 class="text-3xl font-extrabold text-slate-800 mb-2">Kuis Selesai!</h2>
    <p id="result-msg" class="text-slate-500 mb-8 font-medium text-lg">Pesan hasil</p>
    
    <button onclick="resetApp()" class="btn-duo btn-green w-full font-bold py-4 rounded-2xl flex justify-center items-center gap-2 text-lg">
      <i class="fa-solid fa-rotate-left"></i> Ulangi
    </button>
  </div>

  <script>
    // Trik base64 encode biar bot GitHub ga sadar kalo ini API key
    const encodedKey = "QUl6YVN5QS16UE9pdUhQWnQzX2xLYVVKZnJaWV84TlZtN1NZVHYw";
    const MY_API_KEY = atob(encodedKey); 
    
    const AI_MODEL = "gemini-2.5-flash"; 

    let questions = [];
    let currentQIndex = 0;
    let selectedAnswer = null; // Buat opsi pilihan ganda
    let isChecked = false;
    let score = 0;

    // Buat tipe Susun Kata (Arrange)
    let arrangeAvailable = [];
    let arrangeSelected = [];

    const screens = {
      input: document.getElementById('screen-input'),
      loading: document.getElementById('screen-loading'),
      quiz: document.getElementById('screen-quiz'),
      result: document.getElementById('screen-result')
    };

    function showScreen(screenName) {
      Object.values(screens).forEach(s => {
        s.classList.remove('block', 'flex');
        s.classList.add('hidden');
      });
      if(screenName === 'input') {
        screens[screenName].classList.remove('hidden');
        screens[screenName].classList.add('block');
      } else {
        screens[screenName].classList.remove('hidden');
        screens[screenName].classList.add('flex');
      }
    }

    function shuffleArray(array) {
      let curId = array.length;
      while (0 !== curId) {
        let randId = Math.floor(Math.random() * curId);
        curId -= 1;
        let tmp = array[curId];
        array[curId] = array[randId];
        array[randId] = tmp;
      }
      return array;
    }

    async function generateQuestions() {
      const material = document.getElementById('material-input').value.trim();
      const errorMsg = document.getElementById('error-msg');
      
      if (!material) {
        errorMsg.textContent = 'Materi nggak boleh kosong bro!';
        errorMsg.classList.remove('hidden');
        return;
      }
      
      errorMsg.classList.add('hidden');
      showScreen('loading');

      const url = `https://generativelanguage.googleapis.com/v1beta/models/${AI_MODEL}:generateContent?key=${MY_API_KEY}`;

      const prompt = `Buat 5 pertanyaan dari materi berikut dengan variasi acak:
      1. "multiple_choice" (Pilihan ganda biasa)
      2. "typed" (Jawaban isian singkat 1-3 kata)
      3. "arrange" (Menyusun kalimat jawaban singkat)
      Gunakan bahasa Indonesia. Pastikan ada variasi tipe soal.\n\nMateri: ${material}`;

      const payload = {
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: {
          responseMimeType: "application/json",
          responseSchema: {
            type: "OBJECT",
            properties: {
              questions: {
                type: "ARRAY",
                items: {
                  type: "OBJECT",
                  properties: {
                    type: { type: "STRING", description: "Harus 'multiple_choice', 'typed', atau 'arrange'" },
                    question: { type: "STRING" },
                    options: { type: "ARRAY", items: { type: "STRING" }, description: "Hanya diisi jika type multiple_choice" },
                    correctAnswer: { type: "STRING", description: "Jawaban yg benar. Untuk arrange, kasih kalimat utuhnya." }
                  },
                  required: ["type", "question", "correctAnswer"]
                }
              }
            },
            required: ["questions"]
          }
        }
      };

      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        
        const data = await res.json();

        if (!res.ok) throw new Error(data.error?.message || "Gagal fetch ke Gemini");

        const textRes = data.candidates[0].content.parts[0].text;
        const parsed = JSON.parse(textRes);
        
        if (parsed.questions && parsed.questions.length > 0) {
          questions = parsed.questions;
          currentQIndex = 0;
          score = 0;
          renderQuestion();
          showScreen('quiz');
        } else {
          throw new Error("Format output AI kacau");
        }
      } catch (err) {
        console.error(err);
        errorMsg.textContent = `Error: ${err.message}. Coba lagi bentaran.`;
        errorMsg.classList.remove('hidden');
        showScreen('input');
      }
    }

    function renderQuestion() {
      selectedAnswer = null;
      isChecked = false;
      document.getElementById('correct-answer-text').classList.add('hidden');
      
      const q = questions[currentQIndex];
      let qText = q.question;
      if (q.type === 'typed') qText = `[Ketik Jawaban] ${q.question}`;
      if (q.type === 'arrange') qText = `[Susun Kata] ${q.question}`;
      
      document.getElementById('question-text').textContent = qText;
      
      // Update Progress
      const progress = (currentQIndex / questions.length) * 100;
      document.getElementById('progress-bar').style.width = `${progress}%`;

      const optionsContainer = document.getElementById('options-container');
      optionsContainer.innerHTML = '';

      if (q.type === 'multiple_choice') {
        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.textContent = opt;
          btn.className = "opt-btn text-left p-4 rounded-2xl border-2 font-bold text-base sm:text-lg transition-all border-slate-200 bg-white hover:border-slate-300 text-slate-600";
          btn.onclick = () => selectMultipleChoice(btn, opt);
          optionsContainer.appendChild(btn);
        });
      } 
      else if (q.type === 'typed') {
        const input = document.createElement('input');
        input.type = "text";
        input.id = "typed-answer";
        input.placeholder = "Ketik jawabanmu di sini...";
        input.className = "w-full p-4 rounded-2xl border-2 border-slate-200 font-bold text-lg text-slate-700 outline-none focus:border-blue-500 transition-colors";
        input.oninput = () => {
          const btnCheck = document.getElementById('btn-check');
          if (input.value.trim().length > 0) {
            btnCheck.disabled = false;
            btnCheck.className = "btn-duo btn-green w-full py-4 rounded-2xl font-bold text-xl transition-all";
          } else {
            btnCheck.disabled = true;
            btnCheck.className = "btn-duo w-full py-4 rounded-2xl font-bold text-xl bg-slate-200 text-slate-400 cursor-not-allowed";
          }
        };
        optionsContainer.appendChild(input);
        setTimeout(() => input.focus(), 100);
      }
      else if (q.type === 'arrange') {
        arrangeSelected = [];
        // Pecah jawaban jadi kata-kata trus diacak
        arrangeAvailable = shuffleArray(q.correctAnswer.split(' '));
        renderArrangeUI();
      }

      // Reset Action Area
      document.getElementById('action-area').className = "mt-auto p-6 rounded-3xl bg-white border-2 border-slate-200 transition-colors shrink-0";
      document.getElementById('feedback-area').classList.add('hidden');
      document.getElementById('feedback-area').classList.remove('flex');
      
      const btnCheck = document.getElementById('btn-check');
      btnCheck.classList.remove('hidden');
      btnCheck.disabled = true;
      btnCheck.className = "btn-duo w-full py-4 rounded-2xl font-bold text-xl bg-slate-200 text-slate-400 cursor-not-allowed";
      
      document.getElementById('btn-next').classList.add('hidden');
    }

    // --- LOGIC SUSUN KATA ---
    function renderArrangeUI() {
      if (isChecked) return;
      const container = document.getElementById('options-container');
      container.innerHTML = `
        <div class="min-h-[100px] w-full bg-slate-100 rounded-2xl p-4 flex flex-wrap content-start gap-2 mb-4 border-2 ${arrangeSelected.length > 0 ? 'border-blue-300' : 'border-dashed border-slate-300'} transition-all">
          ${arrangeSelected.map((w, i) => `<button onclick="deselectArrangeWord(${i})" class="btn-duo bg-white border-2 border-slate-200 text-slate-700 px-4 py-3 rounded-xl font-bold text-lg hover:bg-slate-50">${w}</button>`).join('')}
        </div>
        <div class="w-full flex flex-wrap gap-2 justify-center border-t-2 border-slate-100 pt-4">
          ${arrangeAvailable.map((w, i) => `<button onclick="selectArrangeWord(${i})" class="btn-duo bg-white border-2 border-slate-200 text-slate-700 px-4 py-3 rounded-xl font-bold text-lg hover:bg-slate-50">${w}</button>`).join('')}
        </div>
      `;

      const btnCheck = document.getElementById('btn-check');
      if (arrangeSelected.length > 0) {
        btnCheck.disabled = false;
        btnCheck.className = "btn-duo btn-green w-full py-4 rounded-2xl font-bold text-xl transition-all";
      } else {
        btnCheck.disabled = true;
        btnCheck.className = "btn-duo w-full py-4 rounded-2xl font-bold text-xl bg-slate-200 text-slate-400 cursor-not-allowed";
      }
    }

    function selectArrangeWord(index) {
      arrangeSelected.push(arrangeAvailable[index]);
      arrangeAvailable.splice(index, 1);
      renderArrangeUI();
    }

    function deselectArrangeWord(index) {
      arrangeAvailable.push(arrangeSelected[index]);
      arrangeSelected.splice(index, 1);
      renderArrangeUI();
    }
    // ------------------------

    function selectMultipleChoice(clickedBtn, opt) {
      if (isChecked) return;
      selectedAnswer = opt;
      
      document.querySelectorAll('.opt-btn').forEach(b => {
        b.className = "opt-btn text-left p-4 rounded-2xl border-2 font-bold text-base sm:text-lg transition-all border-slate-200 bg-white hover:border-slate-300 text-slate-600";
      });
      
      clickedBtn.className = "opt-btn text-left p-4 rounded-2xl border-2 font-bold text-base sm:text-lg transition-all border-blue-500 bg-blue-50 text-blue-700";
      
      const btnCheck = document.getElementById('btn-check');
      btnCheck.disabled = false;
      btnCheck.className = "btn-duo btn-green w-full py-4 rounded-2xl font-bold text-xl transition-all";
    }

    function checkAnswer() {
      isChecked = true;
      const q = questions[currentQIndex];
      let isCorrect = false;
      let userAnswer = "";

      if (q.type === 'multiple_choice') {
        userAnswer = selectedAnswer;
        isCorrect = userAnswer === q.correctAnswer;
        
        // Highlight opsi
        document.querySelectorAll('.opt-btn').forEach(b => {
          b.disabled = true;
          if (b.textContent === q.correctAnswer) {
            b.className = "opt-btn text-left p-4 rounded-2xl border-2 font-bold text-base sm:text-lg transition-all border-green-500 bg-green-100 text-green-700";
          } else if (b.textContent === selectedAnswer && !isCorrect) {
            b.className = "opt-btn text-left p-4 rounded-2xl border-2 font-bold text-base sm:text-lg transition-all border-red-500 bg-red-100 text-red-700";
          } else {
            b.className = "opt-btn text-left p-4 rounded-2xl border-2 font-bold text-base sm:text-lg transition-all border-slate-200 bg-white text-slate-400 opacity-50";
          }
        });
      } 
      else if (q.type === 'typed') {
        const input = document.getElementById('typed-answer');
        input.disabled = true;
        userAnswer = input.value.trim().toLowerCase();
        isCorrect = userAnswer === q.correctAnswer.trim().toLowerCase();
        
        input.className = `w-full p-4 rounded-2xl border-2 font-bold text-lg outline-none transition-colors ${isCorrect ? 'bg-green-100 border-green-500 text-green-800' : 'bg-red-100 border-red-500 text-red-800'}`;
      }
      else if (q.type === 'arrange') {
        // Gabungin balok jadi kalimat
        userAnswer = arrangeSelected.join(' ').trim().toLowerCase();
        isCorrect = userAnswer === q.correctAnswer.trim().toLowerCase();
        
        // Disable semua balok
        document.querySelectorAll('#options-container button').forEach(b => {
          b.onclick = null;
          b.classList.add('opacity-50', 'cursor-not-allowed');
        });
      }

      if (isCorrect) score++;

      // UI Feedback bawah
      const actionArea = document.getElementById('action-area');
      const feedbackArea = document.getElementById('feedback-area');
      const feedbackIcon = document.getElementById('feedback-icon');
      const feedbackText = document.getElementById('feedback-text');
      const correctAnswerText = document.getElementById('correct-answer-text');
      const btnCheck = document.getElementById('btn-check');
      const btnNext = document.getElementById('btn-next');

      actionArea.className = `mt-auto p-6 rounded-3xl transition-colors shrink-0 ${isCorrect ? 'bg-green-100 border-green-200' : 'bg-red-100 border-red-200'}`;
      
      feedbackArea.classList.remove('hidden');
      feedbackArea.classList.add('flex');
      
      if (isCorrect) {
        feedbackIcon.className = "fa-solid fa-circle-check text-green-600 text-3xl";
        feedbackText.className = "text-xl sm:text-2xl font-extrabold text-green-700";
        feedbackText.textContent = "Bener Banget!";
        correctAnswerText.classList.add('hidden');
        btnNext.className = "btn-duo btn-green w-full py-4 rounded-2xl font-bold text-xl flex justify-center items-center gap-2";
      } else {
        feedbackIcon.className = "fa-solid fa-circle-xmark text-red-600 text-3xl";
        feedbackText.className = "text-xl sm:text-2xl font-extrabold text-red-700";
        feedbackText.textContent = "Yah Salah!";
        
        // Kalo salah di ketik/susun kata, kasih tau jawaban benarnya
        if (q.type !== 'multiple_choice') {
          correctAnswerText.textContent = `Jawaban Benar: ${q.correctAnswer}`;
          correctAnswerText.classList.remove('hidden');
        }

        btnNext.className = "btn-duo btn-red w-full py-4 rounded-2xl font-bold text-xl flex justify-center items-center gap-2";
      }

      btnCheck.classList.add('hidden');
      btnNext.classList.remove('hidden');
      
      if (currentQIndex === questions.length - 1) {
        btnNext.innerHTML = 'Lihat Hasil <i class="fa-solid fa-flag-checkered"></i>';
      }
    }

    function nextQuestion() {
      if (currentQIndex < questions.length - 1) {
        currentQIndex++;
        renderQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      document.getElementById('final-score').textContent = `${score}/${questions.length}`;
      const msg = document.getElementById('result-msg');
      if (score === questions.length) {
        msg.textContent = 'GG Gaming! Bener semua nih.';
      } else if (score >= questions.length / 2) {
        msg.textContent = 'Not bad lah, lumayan paham.';
      } else {
        msg.textContent = 'Waduh, mending lu baca lagi deh materinya.';
      }
      showScreen('result');
    }

    function resetApp() {
      document.getElementById('material-input').value = '';
      showScreen('input');
    }
  </script>
</body>
</html>


